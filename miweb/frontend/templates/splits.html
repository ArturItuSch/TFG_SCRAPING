{% extends 'base.html' %}
{% load custom_filters %}

{% block title %}Splits - LEC Stats{% endblock %}

{% block content %}
<div class="container mt-5 text-white">

  <h1 class="mb-4">Splits por Año</h1>

  <!-- BARRA DE BÚSQUEDA Y FILTROS -->
  <form method="get" class="row g-3 align-items-center mb-4">

    <div class="col-auto">
      <input type="text" name="split_type" placeholder="Tipo de split" class="form-control"
            value="{{ request.GET.split_type }}">
    </div>

    <div class="col-auto">
      <select name="league" class="form-select">
        <option value="">Liga (Todas)</option>
        {% for liga in ligas_disponibles %}
          <option value="{{ liga }}" {% if request.GET.league == liga %}selected{% endif %}>{{ liga }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-auto">
      <input type="number" name="year" placeholder="Año" min="2000" max="2100" class="form-control"
            value="{{ request.GET.year }}">
    </div>

    <div class="col-auto">
      <button type="submit" class="btn btn-primary">Buscar</button>
    </div>

  </form>

  <!-- RESULTADOS FILTRADOS POR AÑO -->
  {% if year_ordenados %}
    {% for year in year_ordenados %}
    <div class="card mb-4 bg-dark border-primary">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0">Año {{ year }}</h4>
      </div>
      <div class="card-body">
        <div class="split-row d-grid gap-3" data-split-row>
          {% for split in splits_por_year|dictget:year %}
          <div class="card h-100 border-secondary bg-secondary bg-opacity-25 text-white p-2">
            <div class="card-body d-flex flex-column justify-content-between">
              <div>
                <h5 class="card-title text-capitalize">{{ split.split_type }}</h5>
                <p class="card-text mb-1">Liga: {{ split.league }}</p>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <p>No hay splits registrados.</p>
  {% endif %}
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const splitRows = document.querySelectorAll('[data-split-row]');
    let maxSplits = 0;

    // Calcular la cantidad máxima de splits en un año
    splitRows.forEach(row => {
      const count = row.children.length;
      if (count > maxSplits) maxSplits = count;
    });

    // Aplicar esa cantidad como columnas máximas
    splitRows.forEach(row => {
      row.style.gridTemplateColumns = `repeat(${maxSplits}, 1fr)`;
    });
  });
</script>
{% endblock %}